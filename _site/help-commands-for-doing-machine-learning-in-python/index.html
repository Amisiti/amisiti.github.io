<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>A List of Helpful Commands for Doing Machine Learning in Python</title>
	<meta name="viewport" content="width=device-width">
	<meta name="description" content="Joe is a software engineer living in lower manhattan that specializes in machine learning, statistics, python, and computer vision.">
	<link rel="canonical" href="/help-commands-for-doing-machine-learning-in-python">
	
	<link href='//fonts.googleapis.com/css?family=Titillium+Web:400,200|Lato:300,400,700|Pacifico' rel='stylesheet' type='text/css' />
	
	<!-- Custom CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/icons.css">
	<script type="text/javascript"
	    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
        
    <!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
    for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
    mixpanel.init("4a9ea1c313c2d3a01e19ad4f9558dba4");</script><!-- end Mixpanel -->
</head>

	
	<body>
		<header class="site-header">
	<div class="wrap">
		<a class="site-title" href="/">
		</a>
		<nav class="site-nav">
			<div class="trigger">
			</div>
		</nav>
	</div>
</header>
		
		<div class="page-content">
			<div class="wrap">
				<div class="post" style="padding:1.85em 0.75em;">
	<a class="home-link" href="/">Back To Blog Posts</a>
    <header class="post-header">
		<p class="meta">Feb 17, 2015
            </p>
		
		<h1>A List of Helpful Commands for Doing Machine Learning in Python</h1>
	</header>
	
	<article class="post-content">
		<p>These commands assume you are using the standard <code>scikit-learn</code>,<code>pandas</code>, <code>statsmodels</code>, and <code>matplotlib</code>. If you do not use this ML pipeline, move on, stop reading now.</p>

<h3 id="cross-validation">Cross-Validation</h3>

<p>Cross-validation is a method used for splitting the training setup into <code>test</code> and <code>train</code> sets, and then training the algorithm on the <code>training</code> set and evaluating the algorithm on the <code>test</code> set. You do not need to divide these up manually, it can be done very easily with <code>scikit-learn</code></p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
	     <span class="n">y</span><span class="p">,</span>
	     <span class="n">test_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
	     <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code></pre></div>

<p>It’s important to understand that <code>train_test_split</code> does <strong>NOT</strong> preserve you percentage of samples for each class. If you want to perserve this (and if you have unbalanced classes, you most certainly do), use <code>StratifiedKFold</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
	     <span class="n">y</span><span class="p">,</span>
	     <span class="n">test_size</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
	     <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code></pre></div>

<h3 id="scalingnormalizing-features">Scaling/Normalizing Features</h3>

<p>If different columns values have different magnitudes, you are going to need to normalize your features
before you do any training. To do that, you can use <code>scikit-learn</code>:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">scaler</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code></pre></div>

<p>From the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html">documentation</a>, you 
can read that <code>StandardScaler</code> subtracts the mean and scales to unit variance.</p>

<h3 id="converting-a-pandas-data-frame-to-numpy-matrix-for-scikit-learn">Converting A Pandas Data Frame To Numpy Matrix For Scikit-Learn</h3>

<p>Scikit-learn does not currently accept Panda’s Dataframes, but that is OK, because you
can convert a dataframe into a numpy matrix easily enough with the following command:</p>

<p><code>
X = df.as_matrix().astype(np.float)
</code></p>

<p>Note this will only work if all of your data is <code>boolean</code> + <code>numerical</code> (no text)</p>

<h3 id="dropping-all-rows-that-contain-nan-in-a-given-column">Dropping All Rows That Contain NAN in a Given Column</h3>

<p>If a certain feature is required, you will need to drop any rows in your dataframe
that contain <code>NaN</code> values for that feature. To do this, you can execute something simple
like the following</p>

<p><code>
df = df[np.isfinite(df['FeatureColumn'])]
</code></p>

<h3 id="dropping-useless-columns">Dropping Useless Columns</h3>

<p>Sometimes you have columns in your dataframe that you know are not useful for training a model, so drop them, in place:</p>

<p><code>
df.drop(['UselessColumn1', 'UselessColumn2'], axis=1, inplace=True)
</code></p>

<p>If you look at the columns in your dataframe, <code>UselessColumn1</code> and <code>UselessColumn2</code> should be gone.</p>

<h3 id="discretizing-columns-in-a-dataframe">Discretizing Columns In A Dataframe</h3>

<p>Supervised learning algorithms usually like looking at numerical features, so if you need to convert a column
that contains finite text classes (states, countries, etc.) to numbers, use scikit-learn:</p>

<p>Before:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span>

<span class="n">df</span><span class="o">.</span><span class="n">State</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">72</span><span class="p">]:</span>
<span class="mi">0</span>     <span class="n">KS</span>
<span class="mi">1</span>     <span class="n">OH</span>
<span class="mi">2</span>     <span class="n">NJ</span>
<span class="mi">3</span>     <span class="n">OH</span>
<span class="mi">4</span>     <span class="n">OK</span>
<span class="mi">5</span>     <span class="n">AL</span>
<span class="mi">6</span>     <span class="n">MA</span>
<span class="mi">7</span>     <span class="n">MO</span>
<span class="mi">8</span>     <span class="n">LA</span>
<span class="mi">9</span>     <span class="n">WV</span>
<span class="mi">10</span>    <span class="n">IN</span>
<span class="mi">11</span>    <span class="n">RI</span>
<span class="mi">12</span>    <span class="n">IA</span>
<span class="mi">13</span>    <span class="n">MT</span>
<span class="mi">14</span>    <span class="n">IA</span>
<span class="o">...</span></code></pre></div>

<p>And After:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="n">label_encoder</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s">&#39;State&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;State&#39;</span><span class="p">])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span>

<span class="n">df</span><span class="o">.</span><span class="n">State</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">74</span><span class="p">]:</span>
<span class="mi">0</span>     <span class="mi">16</span>
<span class="mi">1</span>     <span class="mi">35</span>
<span class="mi">2</span>     <span class="mi">31</span>
<span class="mi">3</span>     <span class="mi">35</span>
<span class="mi">4</span>     <span class="mi">36</span>
<span class="mi">5</span>      <span class="mi">1</span>
<span class="mi">6</span>     <span class="mi">19</span>
<span class="mi">7</span>     <span class="mi">24</span>
<span class="mi">8</span>     <span class="mi">18</span>
<span class="mi">9</span>     <span class="mi">49</span>
<span class="mi">10</span>    <span class="mi">15</span>
<span class="mi">11</span>    <span class="mi">39</span>
<span class="mi">12</span>    <span class="mi">12</span>
<span class="mi">13</span>    <span class="mi">26</span>
<span class="mi">14</span>    <span class="mi">12</span>
<span class="o">...</span>
<span class="mi">3318</span>    <span class="mi">36</span>
<span class="mi">3319</span>    <span class="mi">50</span>
<span class="mi">3320</span>    <span class="mi">10</span>
<span class="mi">3321</span>    <span class="mi">46</span>
<span class="mi">3322</span>    <span class="mi">20</span>
<span class="mi">3323</span>    <span class="mi">15</span>
<span class="mi">3324</span>    <span class="mi">49</span></code></pre></div>

<h3 id="boolean-ands-or-ors-with-two-columns">Boolean ANDs or ORs with two columns</h3>

<p>Sometimes you want to filter a given set of rows in a dataframe by ANDing or ORing together two columns and take the result. This can be done like this</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">valid_columns</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Column1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Column2</span><span class="p">)</span>
<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">valid_columns</span><span class="p">,]</span></code></pre></div>

<p>The parentheses are very important, otherwise pandas will complain.</p>

<h3 id="plotting-multiple-columns-in-pandas-via-subplots">plotting multiple columns in pandas via subplots</h3>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df1</span><span class="p">[[</span><span class="s">&quot;column1&quot;</span><span class="p">,</span><span class="s">&quot;column1&quot;</span><span class="p">,</span><span class="s">&quot;column1&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;hist&#39;</span><span class="p">,</span><span class="n">subplots</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span></code></pre></div>


	</article>
    
    <script>
        mixpanel.track("A List of Helpful Commands for Doing Machine Learning in Python");
    </script>
    
</div>
			</div>
		</div>
		<footer class="site-footer">
	<div class="wrap">
		<div class="footer-col-1 column">
			<ul>
				<li>Math, CS, Statsitics, and the occasional book review</li>
				<li>
					<a href="mailto:"></a>
				</li>
			</ul>
		</div>
		
		<div class="footer-col-2 column">
			<ul>
				<li>
					<a class="icons icon-signup" href="/feed.xml"></a>
				</li>
				
				<li>
					<a class="icons icon-github2" href="https://github.com/">
						<span class="username"></span>
					</a>
				</li>
				
				<li>
					<a class="icons icon-twitter" href="https://twitter.com/">
						<span class="username"></span>
					</a>
				</li>
			</ul>
		</div>
		
		<div class="footer-col-3 column">
			<p class="text">Joe is a software engineer living in lower manhattan that specializes in machine learning, statistics, python, and computer vision.</p>
		</div>
	</div>
</footer>
	</body>
</html>